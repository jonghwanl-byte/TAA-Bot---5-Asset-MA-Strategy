name: Daily MA Strategy Report

on:
  schedule:
    # ë§¤ì¼ 23:00 UTCì— ì‹¤í–‰ (í•œêµ­ ì‹œê°„ KST = UTC + 9, ì¦‰ ì˜¤ì „ 8ì‹œ)
    - cron: '0 23 * * *'
    
  workflow_dispatch: # Actions íƒ­ì— ìˆ˜ë™ ì‹¤í–‰ ë²„íŠ¼ì„ í‘œì‹œí•˜ëŠ” íŠ¸ë¦¬ê±°
    inputs:
      test_mode:
        description: 'Enable Test Mode (Bypasses weekend check, runs on latest data).'
        required: true
        default: 'FALSE'
        type: choice
        options:
        - 'TRUE'
        - 'FALSE'

jobs:
  run_daily_strategy:
    runs-on: ubuntu-latest
    
    steps:
    - name: ğŸ“¦ ì½”ë“œ ì²´í¬ì•„ì›ƒ
      uses: actions/checkout@v3

    - name: ğŸ Python í™˜ê²½ ì„¤ì •
      uses: actions/setup-python@v3
      with:
        python-version: '3.x'

    - name: âš™ï¸ ì¢…ì†ì„± ì„¤ì¹˜ (requirements.txt)
      run: pip install -r requirements.txt

    # --- 1. MA ì „ëµ ì‹¤í–‰ ë° ê²°ê³¼ ìº¡ì²˜ (ë³€ìˆ˜ í†µí•©) ---
    - name: ğŸš€ MA ì „ëµ ì‹¤í–‰ ë° ê²°ê³¼ ìº¡ì²˜
      id: strategy_output
      run: |
        # Python ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰ í™˜ê²½ ë³€ìˆ˜ë¥¼ ì—¬ê¸°ì„œ ì§ì ‘ ì„¤ì • (YAML ì˜¤ë¥˜ íšŒí”¼)
        export TEST_MODE=${{ github.event.inputs.test_mode }}
        export TELEGRAM_TOKEN=${{ secrets.TELEGRAM_TOKEN }}
        export TELEGRAM_CHAT_ID=${{ secrets.TELEGRAM_CHAT_ID }}
        
        # Python ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰ ê²°ê³¼ë¥¼ GITHUB_OUTPUTìœ¼ë¡œ ìº¡ì²˜
        echo "report<<EOF" >> $GITHUB_OUTPUT
        python daily_signal_generator.py >> $GITHUB_OUTPUT
        echo "EOF" >> $GITHUB_OUTPUT

    # --- 2. í…”ë ˆê·¸ë¨ ë©”ì‹œì§€ ì „ì†¡ ---
    - name: ğŸ“© í…”ë ˆê·¸ë¨ ë©”ì‹œì§€ ì „ì†¡
      uses: appleboy/telegram-action@master
      with:
        to: ${{ secrets.TELEGRAM_CHAT_ID }} 
        token: ${{ secrets.TELEGRAM_TOKEN }}
        message: ${{ steps.strategy_output.outputs.report }}
        format: markdown 
      if: always()
