name: Daily MA Strategy Report

on:
  schedule:
    # ë§¤ì¼ 23:00 UTCì— ì‹¤í–‰ (í•œêµ­ ì‹œê°„ KST = UTC + 9, ì¦‰ ì˜¤ì „ 8ì‹œ)
    - cron: '0 23 * * *'
    
  workflow_dispatch: # Actions íƒ­ì— ìˆ˜ë™ ì‹¤í–‰ ë²„íŠ¼ì„ í‘œì‹œí•˜ëŠ” íŠ¸ë¦¬ê±°
    inputs:
      test_mode:
        description: 'Enable Test Mode (Bypasses weekend check, runs on latest data).'
        required: true
        default: 'FALSE'
        type: choice
        options:
        - 'TRUE'
        - 'FALSE'

jobs:
  run_daily_strategy:
    runs-on: ubuntu-latest
    
    steps:
    - name: ğŸ“¦ ì½”ë“œ ì²´í¬ì•„ì›ƒ
      uses: actions/checkout@v3

    - name: ğŸ Python í™˜ê²½ ì„¤ì •
      uses: actions/setup-python@v3
      with:
        python-version: '3.x'

    - name: âš™ï¸ ì¢…ì†ì„± ì„¤ì¹˜ (requirements.txt)
      run: pip install -r requirements.txt

    - name: ğŸš€ MA ì „ëµ ì‹¤í–‰ ë° ê²°ê³¼ ìº¡ì²˜
      id: strategy_output
      env:
        # L35 ì˜¤ë¥˜ ë°©ì§€: 8ì¹¸ ê³µë°±
        TEST_MODE: ${{ github.event.inputs.test_mode }}
      run: |
        # í™˜ê²½ ë³€ìˆ˜ë¥¼ Bashë¡œ ì§ì ‘ export
        export TEST_MODE=${{ github.event.inputs.test_mode }}
        
        # ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰ (STDERRë¥¼ STDOUTìœ¼ë¡œ ë¦¬ë‹¤ì´ë ‰ì…˜)
        REPORT_CONTENT=$(python daily_signal_generator.py 2>&1)
        
        # GITHUB_OUTPUTì— ìº¡ì²˜ëœ ë‚´ìš© í• ë‹¹
        echo "report<<EOF" >> $GITHUB_OUTPUT
        echo "$REPORT_CONTENT" >> $GITHUB_OUTPUT
        echo "EOF" >> $GITHUB_OUTPUT

    - name: ğŸ“© í…”ë ˆê·¸ë¨ ë©”ì‹œì§€ ì „ì†¡
      uses: appleboy/telegram-action@master
      with:
        to: ${{ secrets.TELEGRAM_CHAT_ID }} 
        token: ${{ secrets.TELEGRAM_TOKEN }}
        message: ${{ steps.strategy_output.outputs.report }}
        format: markdown 
      if: always()
